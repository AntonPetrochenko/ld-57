pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- player = {
--  x = 64,
--  y = 64
-- }

-- poke(0x5f2d, 0x1)

function player_gfx_controller(p)

 -- f,x,y,h,v
	local pickaxe_frames = {
	 [0] = { {6,8,0,false,false},{5,6,6,false,true},{4,0,8,false,true} },
	 [1] = { {4,0,-8,false,false},{5,6,-6,false,false},{6,8,0,false,false} },
	 [2] = { {6,-8,0,true,false},{5,-6,-6,true,false},{4,0,-8,true,false} },
	 [3] = { {4,0,-8,true,false},{5,-6,-6,true,false},{6,-8,0,true,false} },
	}

	local player_dir = 0
	local step_state = 0
	local step_timer = 0
	local pickaxe_frame_timer = 0

	local damage_timer = 0

	local dmg = function()
		damage_timer = 15
	end
	local f = function()
	
		step_timer -= 1
		damage_timer -= 1
		pickaxe_frame_timer -= pickaxe_frame_timer > 1 and 0.7 or 0.2
		if step_timer <= 0 then step_state = 0 else step_state = 16 end 
	
		if (btnp(⬇️)) player_dir = 0 step_timer = 6
		if (btnp(➡️)) player_dir = 1 step_timer = 6
		if (btnp(⬆️)) player_dir = 2 step_timer = 6
		if (btnp(⬅️)) player_dir = 3 step_timer = 6
	
		if (damage_timer > 0) then
			for i=1,15 do
				pal(i,1+flr(rnd(15)))
			end
		end
		spr(player_dir+step_state,player.x, player.y)
		pal()

		if pickaxe_frame_timer >= 0 then
			local animation_set = pickaxe_frames[player_dir]
			local pickaxe_animation_duration = 3
			local current_pickaxe_frame = ceil(pickaxe_animation_duration - pickaxe_frame_timer)
			local cpfd = animation_set[current_pickaxe_frame]

			if cpfd then
				spr(cpfd[1], player.x + cpfd[2], player.y + cpfd[3], 1,1, cpfd[4], cpfd[5])
			else
				print(cpfd)
				print(animation_set)
				print(current_pickaxe_frame)
			end
		end

	end
	
	local s = function() pickaxe_frame_timer = 3	end

	local g = function()
		return player_dir
	end

	
	
	return f,s,g,dmg
	
end


function spider_gfx_controller(p)
	local pavuk_health = 100
	local pavuk_timer = 0
	local pavuk_damage_timer = 0

	
	local d = function(n)
		pavuk_damage_timer = 15
		pavuk_health -= n
	end

	local f = function()

		fk_arms = {
			{-32,16},
			{-32,6},
			{-24,10},
			{-24,22},
			
			{32,16},
			{32,6},
			{24,10},
			{24,22},
		}

		

		pavuk_timer += tmp_camera_speed or 0
		pavuk_damage_timer -= 1

		local pavuk_base_color = (pavuk_damage_timer > 0) and flr(rnd(15)) or 5

		local c_bak = peek4(0x5f28)
		camera(-64,0)

		local function draw_fk_arms(c,a,b)
			for i=1,#fk_arms do
				local arm = fk_arms[i]
				local offset_x = sin((i>4 and pavuk_timer or -pavuk_timer) /40+i/4 + (i>4 and 0.2 or 0))*8
				local offset_y = cos((i>4 and pavuk_timer or -pavuk_timer) /40+i/4 + (i>4 and 0.2 or 0))*8
				for vi = a,b do
					line(0,24+vi,arm[1]+offset_x,arm[2]+offset_y+vi,c)
		
					line(
						arm[1]+offset_x,
						arm[2]+offset_y+vi,
						arm[1]+offset_x+(arm[1]+offset_x)/2,
						arm[2]+offset_y+(arm[2]+offset_y)/2+vi,
						c
					)
				end
			end
		end

		ovalfill(-21,-1,21,33,0)
		draw_fk_arms(0,-1,pavuk_base_color)

		
		
		ovalfill(-20,0,20,32,pavuk_base_color)
		draw_fk_arms(pavuk_base_color,0,4)

		local eye_anchor_x = 0
		local eye_anchor_y = 24

		circfill(0,24,7,7)

		local phi = atan2(eye_anchor_y-player.y,eye_anchor_x-player.x+64)

		if (pavuk_damage_timer > 0) then
			phi = pavuk_timer*0.9
		end
		local pdx = -sin(phi)*4
		local pdy = -cos(phi)*4

		

		circfill(eye_anchor_x+pdx,eye_anchor_y+pdy,3,8)

		spr(9,-12,-2,3,3)
		spr(28,-22,6,2,2)
		spr(28,6,6,2,2,true)

		poke4(0x5f28,c_bak)

		pavuk_health = mid(0,pavuk_health,100)
		rectfill(3,3,125,6,0)
		rectfill(3,3,3+(pavuk_health/100)*125,6,8)
		
		print('🐱 gIANT ENEMY SPIDER',4,4,0)
		print('🐱 gIANT ENEMY SPIDER',3,3,7)

	end

	return f
end

local draw_p, atk_p = player_gfx_controller()
local s_gfx = spider_gfx_controller()

-- while true do  
-- 	if btnp()>0 then atk_p() end  
-- 	player.x = stat(32)
-- 	player.y = stat(33)
-- 	cls() 
-- 	s_gfx() 
-- 	draw_p() 
-- 	flip() 
-- end
__gfx__
000000000000000000000000000000000000000000000000000070000000000000600000000000000000000000000000110a7011110c7011110b701111087011
00a88a00000aa80000aaaa00008aa0000077660007776000000007000000000006d6000000000000000000000000000010aa770110cc770110bb770110887701
098778a0009a877009aaaaa00778aa00076666600006670000000670006000006ddd60660000000000000000000000000aaa77700ccc77700bbb777008887770
0986689000998660099999900668990070021006000166602222267006d66066ddddd6dd000000000000000000000000aaaa7777cccc7777bbbb777788887777
061771700067717006777770071777000002100000121660111116600dddd6dddd000d8d000000000000000000000000888899991111dddd5555333311112222
067777700067777006777770077777000002100001210060000006600ddd0d8dd0000d8d000000000000000000000000088899900111ddd00555333001112220
011111100011111001111110011111000002100012100060000006000dd00d8d000000dd000000000000000000000000108899011011dd011055330110112201
09a009a0009a09a009a009a009a09a000002100021000000000060000d0000dd00000000000000000000000000000000110890111101d0111105301111012011
000000000000000000aaaa000000000066a88a660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000aa8009aaaaa008aa0000678778670000000000000000000158500000000000000000000000000000000000000000000000000000000000000000
00a88a000009a87709999990778aa000098668900000000000000000001555550001585000000000000000000000000000000000000000000000000000000000
098778a0000998660677777066899000061771700000000000000000001550d00015555500000000000000000000000000000000000000000000000000000000
0986689000067717067779a07177700006777770000000000000000000155400001550d000000000000000000000000000000000000000000000000000000000
0617717000a67777011119a077777a00067777700000000000000000000015400015450000000000000000000000000000000000000000000000000000000000
067777700099111109a0000011119900011111100000000000000000000154500155540000000000000000000000000000000000000000000000000000000000
09a111100000009a000000009a00000009a009a00000000000000000015555401555400000000000000000000000000000000000000000000000000000000000
00000000000000000007000000070000000000000000000000000000000009000000000000000000000000000000000000000000000000000000000000000000
00000000000000000007000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000000000
00000000000700000000000000000000000000000000000000000000000990000000000000000000000000000000000000000000000000000000000000000000
00070000007070007700077070000070000000000000000000000000009799000000000000000000000000000000000000000000000000000000000000000000
00000000000700000000000000000000000000000000000000000000009a79000000000000000000000000000000000000000000000000000000000000000000
00000000000000000007000000000000000000000000000000000000091aa1900000000000000000000000000000000000000000000000000000000000000000
00000000000000000007000000070000000000000000000000000000091a91900000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000009999000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000aaaa0000aaaa000070070000000000000000000000000000000000007777000077770000700700000000000000000000000000
0000000000000000000aa0000a9999a00a0000a00000000000000000000000000000000000077000077777700700007000000000000000000000000000000000
00000000000aa00000a99a00a990099aa000000a7000000700000000000000000007700000777700777007777000000770000007000000000000000000000000
0008800000a99a000a9009a0a900009aa000000a0000000000000000000770000077770007700770770000777000000700000000000000000000000000000000
0008800000a99a000a9009a0a900009aa000000a0000000000000000000770000077770007700770770000777000000700000000000000000000000000000000
00000000000aa00000a99a00a990099aa000000a7000000700000000000000000007700000777700777007777000000770000007000000000000000000000000
0000000000000000000aa0000a9999a00a0000a00000000000000000000000000000000000077000077777700700007000000000000000000000000000000000
00000000000000000000000000aaaa0000aaaa000070070000000000000000000000000000000000007777000077770000700700000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10000001100000011000000110101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d16d600121828000666666001010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d1dd6d6121228281dd66666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d1dd6d112122821ddd6666610101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000100000001000dddd666600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1d6001dd12800122ddddd66600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d6d61d1d28281212dddddd6601000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
6d6d11d1228211211dddddd100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10000001101111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08282820110111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20828282111111010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02082828111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20208282101111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02020828110111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20202080111111010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
12020201111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
10000001100000011000000110000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0d6666600d6666600d6666600d666660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
da766666dc766666db766666d8766666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
d8966666d1d66666d5366666d1266666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddd6666dddd6666dddd6666dddd6666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddda76dddddc76dddddb76ddddd876000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd896ddddd1d6ddddd536ddddd126000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1dddddd11dddddd11dddddd11dddddd1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
40400f400f0f4040400040000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040000040404040404000404000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040000000404040400000000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040004040004040004040000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040000000000000000000400000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040009191919191919191000000404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040919191919191919191919100404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a0a0a0a0a0a0a0a0a0a0a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a080a0909090a08282a0a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040808080a090a0a0828282a0a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a0a0a0a0a0a0a0818181a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a083838383a0a0a08181a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a000000000a0a0a0a0a0a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4040a0a0a0a0a0a0a0a0a0a0a0a0404000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
